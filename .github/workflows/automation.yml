name: PLP 50-Terminal Simulation

on:
  workflow_dispatch:

jobs:
  multi_terminal:
    name: Terminal ${{ matrix.id }}
    runs-on: ubuntu-latest
    timeout-minutes: 43200

    strategy:
      matrix:
        id: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10,
             11,12,13,14,15,16,17,18,19,20,
             21,22,23,24,25,26,27,28,29,30,
             31,32,33,34,35,36,37,38,39,40,
             41,42,43,44,45,46,47,48,49,50]
      max-parallel: 20  # GitHub limit â€” only 20 run at once

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.10"

      - name: Install dependencies
        run: |
          pip install -U pip
          pip install requests aiohttp python-dotenv

      - name: Run Terminal ${{ matrix.id }}
        env:
          PLP_EMAIL: ${{ secrets.PLP_EMAIL }}
          PLP_PASSWORD: ${{ secrets.PLP_PASSWORD }}
        run: |
          echo "ğŸŸ¢ Terminal ${{ matrix.id }} started"
          touch terminal_${{ matrix.id }}.log

          while true; do
            echo "[Terminal ${{ matrix.id }}] ğŸ•’ $(date) - Running script..." | tee -a terminal_${{ matrix.id }}.log
            python3 login_automation.py >> terminal_${{ matrix.id }}.log 2>&1 || echo "[Terminal ${{ matrix.id }}] âŒ Script failed" | tee -a terminal_${{ matrix.id }}.log
            sleep 0.5
          done
